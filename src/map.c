#include "map.h"

unsigned char map_tiles[MAP_SIZE] = {
  0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
  0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01,
  0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01,
  0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01,
  0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01,
  0x01, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01,
  0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01,
  0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01,
  0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01,
  0x01, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x04, 0x05, 0x01,
  0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x06, 0x07, 0x01,
  0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x03, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x02,
};

unsigned int _meta_tiles[][4] = {
  { 0x13, 0x13, 0x13, 0x13 },
  { 0x09, 0x0a, 0x1c, 0x1d },
  { 0x7a, 0x7b, 0x80, 0x81 },
  { 0x5d, 0x5d|TILE_FLIPPED_X, 0x68, 0x68|TILE_FLIPPED_X },
  { 0x7c, 0x7d, 0x82, 0x83 },
  { 0x7e, 0x7f, 0x84, 0x85 },
  { 0x86, 0x87, 0x8a, 0x8b },
  { 0x88, 0x89, 0x8c, 0x8d }
};

void init_map() {
}

void _draw_map_row(char row_number) {
  SMS_setNextTileatXY(0, (row_number << 1));

  for (char x = 0; x < MAP_WIDTH; ++x) {
    const char meta_tile_idx = map_tiles[row_number * MAP_WIDTH + x];

    SMS_setTile(_meta_tiles[meta_tile_idx][0]);
    SMS_setTile(_meta_tiles[meta_tile_idx][1]);
  }

  for (char x = 0; x < MAP_WIDTH; ++x) {
    const char meta_tile_idx = map_tiles[row_number * MAP_WIDTH + x];

    SMS_setTile(_meta_tiles[meta_tile_idx][2]);
    SMS_setTile(_meta_tiles[meta_tile_idx][3]);
  }
}

void draw_map() {
  // SMS_VRAMmemcpy(0x3800, map_tiles, 2 * 32 * 24);
  for (unsigned char row = 0; row < MAP_HEIGHT; ++row) {
    _draw_map_row(row);
  }
}

char lookup_tile(char tile_x, char tile_y) {
  return map_tiles[tile_y * MAP_WIDTH + tile_x];
}
